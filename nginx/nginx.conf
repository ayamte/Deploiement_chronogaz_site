events {  
    worker_connections 1024;  
}  
  
http {  
    # Upstream pour le frontend React  
    upstream frontend {  
        server frontend:3000;  
    }  
  
    # Upstream pour le backend Express  
    upstream backend {  
        server app:5000;  
    }  
  
    server {  
        listen 80;  
        server_name localhost;  
  
        # Proxy vers le frontend React  
        location / {  
            proxy_pass http://frontend;  
            proxy_http_version 1.1;  
            proxy_set_header Upgrade $http_upgrade;  
            proxy_set_header Connection 'upgrade';  
            proxy_set_header Host $host;  
            proxy_cache_bypass $http_upgrade;  
        }  
  
        # Proxy vers l'API backend  
        location /api {  
            proxy_pass http://backend;  
            proxy_http_version 1.1;  
            proxy_set_header Upgrade $http_upgrade;  
            proxy_set_header Connection 'upgrade';  
            proxy_set_header Host $host;  
            proxy_cache_bypass $http_upgrade;  
        }  
  
        # Proxy pour Socket.IO (WebSocket)  
        location /socket.io {  
            proxy_pass http://backend;  
            proxy_http_version 1.1;  
            proxy_set_header Upgrade $http_upgrade;  
            proxy_set_header Connection 'upgrade';  
            proxy_set_header Host $host;  
            proxy_cache_bypass $http_upgrade;  
        }  
    }  
}